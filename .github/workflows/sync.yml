name: "Sync Code"

on:
  push: # run if we update the workflow
  workflow_dispatch:
  schedule:
    - cron: '39 13 * * 4'
permissions:
  contents: write
jobs:
  sync:
    name: Sync (${{ matrix.repo }})
    # Runner size impacts CodeQL analysis time. To learn more, please see:
    #   - https://gh.io/recommended-hardware-resources-for-running-codeql
    #   - https://gh.io/supported-runners-and-hardware-resources
    #   - https://gh.io/using-larger-runners (GitHub.com only)
    # Consider using larger runners or machines with greater resources for possible analysis time improvements.
    runs-on: 'ubuntu-latest'

    strategy:
      matrix:
        include:
          - repository: spring-io/spring-github-workflows
            branch: main
    steps:
      - name: Checkout repository # setup credentials for push
        uses: actions/checkout@v4

      - name: Sync
        run: |
          export REMOTE_BRANCH='${{ matrix.repository }}/${{ matrix.branch }}'
          export REMOTE_NAME=remote-to-sync
          export REMOTE_PUSH=remote-to-push
          git remote add "$REMOTE_NAME" 'https://github.com/${{ matrix.repository }}'
          git remote add "$REMOTE_PUSH" 'https://${{ secrets.SPRING_CODEQL_PUSH }}@github.com/${{ github.repository }}'
          git fetch "$REMOTE_NAME"
          git checkout -B "$REMOTE_BRANCH" "$REMOTE_NAME/${{ matrix.branch }}"
          git push "$REMOTE_PUSH"
